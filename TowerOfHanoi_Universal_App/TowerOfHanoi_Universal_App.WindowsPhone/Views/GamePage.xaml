<Page
    x:Class="TowerOfHanoi_Universal_App.Views.GamePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:TowerOfHanoi_Universal_App.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Background>
        <ImageBrush ImageSource="{Binding GameSettings.GameTheme, Converter={StaticResource ThemeConverter}, Mode=OneWay}" Stretch="UniformToFill" />
    </Page.Background>

    <Page.Resources>

        <!--Tower of Hanoi Styles-->
        <Style x:Key="TowerOfHanoiLeaderBoardHeaderStyle" TargetType="TextBlock" BasedOn="{StaticResource MessageDialogContentStyle}">
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="MinWidth" Value="120" />
            <Setter Property="Margin" Value="12, 4" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
        </Style>
        <Style x:Key="TowerOfHanoiLeaderBoardTextStyle" TargetType="TextBlock" BasedOn="{StaticResource BodyTextBlockStyle}">
            <Setter Property="FontFamily" Value="{ThemeResource PhoneFontFamilyLight}" />
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="MinWidth" Value="120" />
            <Setter Property="Margin" Value="12, 4" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
        </Style>
        <Style x:Key="TowerOfHanoiMenuStyle" TargetType="Line">
            <Setter Property="StrokeThickness" Value="4"/>
            <Setter Property="Stroke" Value="Black"/>
            <Setter Property="IsHitTestVisible" Value="True" />
            <Setter Property="IsTapEnabled" Value="True" />
            <Setter Property="Margin" Value="0.5" />
            <Setter Property="X1" Value="0"/>
            <Setter Property="X2" Value="25"/>
            <Setter Property="Y1" Value="5"/>
            <Setter Property="Y2" Value="5"/>
        </Style>
        <Style x:Key="TowerOfHanoiPhoneTitleTextBlockStyle" TargetType="TextBlock" BasedOn="{StaticResource TowerOfHanoiTitleTextBlockStyle}">
            <Setter Property="FontSize" Value="{ThemeResource TextStyleLargeFontSize}" />
            <Setter Property="FontFamily" Value="{ThemeResource PhoneFontFamilySemiLight}" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="FontWeight" Value="Bold" />
        </Style>
        <Style x:Key="TowerOfHanoiPhoneInfoTextBlockStyle" TargetType="TextBlock" BasedOn="{StaticResource TowerOfHanoiInfoTextBlockStyle}">
            <Setter Property="FontSize" Value="{ThemeResource TextStyleLargeFontSize}" />
            <Setter Property="FontFamily" Value="{ThemeResource PhoneFontFamilySemiLight}" />
        </Style>

        <!--Tower of Hanoi ListView Style-->
        <Style x:Key="TowerOfHanoiListViewStyle" TargetType="ListView">
            <Setter Property="Padding" Value="2"/>
            <Setter Property="Margin" Value="10, 2"/>
            <Setter Property="IsTabStop" Value="False"/>
            <Setter Property="TabNavigation" Value="Once"/>
            <Setter Property="AllowDrop" Value="True"/>
            <Setter Property="CanDragItems" Value="True"/>
            <Setter Property="CanReorderItems" Value="False"/>
            <Setter Property="IsSwipeEnabled" Value="True"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.HorizontalScrollMode" Value="Disabled"/>
            <Setter Property="ScrollViewer.IsHorizontalRailEnabled" Value="False"/>
            <Setter Property="ScrollViewer.VerticalScrollMode" Value="Disabled"/>
            <Setter Property="ScrollViewer.IsVerticalRailEnabled" Value="False"/>
            <Setter Property="ScrollViewer.ZoomMode" Value="Disabled"/>
            <Setter Property="ScrollViewer.IsDeferredScrollingEnabled" Value="False"/>
            <Setter Property="ScrollViewer.BringIntoViewOnFocusChange" Value="False"/>
            <Setter Property="BorderThickness" Value="0,0,0,5"/>
            <Setter Property="BorderBrush" Value="White"/>
            <Setter Property="VerticalAlignment" Value="Bottom"/>
            <Setter Property="VerticalContentAlignment" Value="Bottom"/>
            <Setter Property="Height" Value="254"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="Background">
                <Setter.Value>
                    <ImageBrush ImageSource="ms-appx:///Assets/Cloud_Pole.png" Stretch="Fill" />
                </Setter.Value>
            </Setter>
            <Setter Property="ItemContainerTransitions">
                <Setter.Value>
                    <TransitionCollection>
                        <EdgeUIThemeTransition/>
                    </TransitionCollection>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel Orientation="Vertical" VerticalAlignment="Bottom"/>
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListView">
                        <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
                            <ScrollViewer x:Name="ScrollViewer" BringIntoViewOnFocusChange="{TemplateBinding ScrollViewer.BringIntoViewOnFocusChange}" HorizontalScrollMode="{TemplateBinding ScrollViewer.HorizontalScrollMode}" HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}" IsHorizontalRailEnabled="{TemplateBinding ScrollViewer.IsHorizontalRailEnabled}" IsHorizontalScrollChainingEnabled="{TemplateBinding ScrollViewer.IsHorizontalScrollChainingEnabled}" IsVerticalScrollChainingEnabled="{TemplateBinding ScrollViewer.IsVerticalScrollChainingEnabled}" IsVerticalRailEnabled="{TemplateBinding ScrollViewer.IsVerticalRailEnabled}" IsDeferredScrollingEnabled="{TemplateBinding ScrollViewer.IsDeferredScrollingEnabled}" TabNavigation="{TemplateBinding TabNavigation}" VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}" VerticalScrollMode="{TemplateBinding ScrollViewer.VerticalScrollMode}" ZoomMode="{TemplateBinding ScrollViewer.ZoomMode}">
                                <ItemsPresenter HeaderTemplate="{TemplateBinding HeaderTemplate}" Header="{TemplateBinding Header}" HeaderTransitions="{TemplateBinding HeaderTransitions}" Padding="{TemplateBinding Padding}"/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ListViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="TabNavigation" Value="Local"/>
            <Setter Property="IsHoldingEnabled" Value="True"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <ContentPresenter Margin="0"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--Tower of Hanoi GridView Style-->
        <FontFamily x:Key="ContentControlThemeFontFamily">Segoe WP</FontFamily>
        <x:Double x:Key="ControlContentThemeFontSize">12</x:Double>
        <Thickness x:Key="GridViewItemMargin">4</Thickness>
        <SolidColorBrush x:Key="CheckBoxBackgroundThemeBrush" Color="Transparent"/>
        <x:Double x:Key="CheckBoxBorderThemeThickness">2.5</x:Double>
        <x:Double x:Key="ListViewItemContentOffsetX">-40.5</x:Double>
        <Thickness x:Key="ListViewItemMultiselectCheckBoxMargin">0,9.5,0,0</Thickness>
        <Thickness x:Key="GridViewItemMultiselectBorderThickness">2.5</Thickness>
        <x:Double x:Key="ListViewItemDisabledThemeOpacity">0.4</x:Double>
        <x:Double x:Key="ListViewItemContentTranslateX">40.5</x:Double>
        <x:Double x:Key="ListViewItemReorderHintThemeOffset">32</x:Double>
        <Style x:Key="TowerofHanoiGridViewItemStyle" TargetType="GridViewItem">
            <Setter Property="FontFamily" Value="{ThemeResource ContentControlThemeFontFamily}"/>
            <Setter Property="FontSize" Value="{ThemeResource ControlContentThemeFontSize}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="TabNavigation" Value="Local"/>
            <Setter Property="IsHoldingEnabled" Value="False"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="{ThemeResource PhoneForegroundBrush}"/>
            <Setter Property="Margin" Value="{ThemeResource GridViewItemMargin}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GridViewItem">
                        <Border x:Name="OuterContainer" RenderTransformOrigin="0.5,0.5">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="ContentScaleTransform"/>
                            </Border.RenderTransform>
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualStateGroup.Transitions>
                                        <VisualTransition From="Pressed" To="Normal">
                                            <Storyboard>
                                                <PointerUpThemeAnimation Storyboard.TargetName="TiltContainer"/>
                                            </Storyboard>
                                        </VisualTransition>
                                    </VisualStateGroup.Transitions>
                                    <VisualState x:Name="Normal"/>
                                    <VisualState x:Name="Pressed">
                                        <Storyboard>
                                            <DoubleAnimation Duration="0" To="1" Storyboard.TargetProperty="Opacity" Storyboard.TargetName="SelectedBorder"/>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>

                                <VisualStateGroup x:Name="SelectionStates">
                                    <VisualState x:Name="Unselected"/>
                                    <VisualState x:Name="Selected">
                                        <Storyboard>
                                            <DoubleAnimation Duration="0" To="1" Storyboard.TargetProperty="Opacity" Storyboard.TargetName="SelectedBorder"/>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <Grid x:Name="ReorderHintContent" Background="Transparent">
                                <Border x:Name="CheckboxTiltContainer" HorizontalAlignment="Left" Margin="{ThemeResource ListViewItemMultiselectCheckBoxMargin}" VerticalAlignment="Top">
                                    <Border x:Name="CheckboxOuterContainer">
                                        <Border.Clip>
                                            <RectangleGeometry Rect="0,0,25.5,25.5"/>
                                        </Border.Clip>
                                        <Grid x:Name="CheckboxContainer">
                                            <Grid.RenderTransform>
                                                <TranslateTransform x:Name="CheckboxContainerTranslateTransform" X="{ThemeResource ListViewItemContentOffsetX}"/>
                                            </Grid.RenderTransform>
                                            <Rectangle x:Name="NormalRectangle" Fill="{ThemeResource CheckBoxBackgroundThemeBrush}" Height="25.5" Stroke="{ThemeResource CheckBoxBorderThemeBrush}" StrokeThickness="{ThemeResource CheckBoxBorderThemeThickness}" Width="25.5"/>
                                            <Path x:Name="CheckGlyph" Data="M0,123 L39,93 L124,164 L256,18 L295,49 L124,240 z" Fill="{ThemeResource CheckBoxForegroundThemeBrush}" FlowDirection="LeftToRight" HorizontalAlignment="Center" Height="17" IsHitTestVisible="False" Opacity="0" Stretch="Fill" StrokeThickness="2.5" StrokeLineJoin="Round" VerticalAlignment="Center" Width="18.5"/>
                                        </Grid>
                                    </Border>
                                </Border>
                                <Border x:Name="ContentContainer">
                                    <Border x:Name="TiltContainer">
                                        <Border x:Name="ContentBorder" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
                                            <Border.RenderTransform>
                                                <TranslateTransform x:Name="ContentBorderTranslateTransform"/>
                                            </Border.RenderTransform>
                                            <Grid>
                                                <ContentPresenter x:Name="contentPresenter" ContentTemplate="{TemplateBinding ContentTemplate}" ContentTransitions="{TemplateBinding ContentTransitions}" Content="{TemplateBinding Content}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                                <TextBlock x:Name="PlaceholderTextBlock" AutomationProperties.AccessibilityView="Raw" Foreground="{x:Null}" IsHitTestVisible="False" Margin="{TemplateBinding Padding}" Opacity="0" Text="Xg"/>
                                                <Rectangle x:Name="PlaceholderRect" Fill="{ThemeResource GridViewItemPlaceholderBackgroundThemeBrush}" IsHitTestVisible="False" Visibility="Collapsed"/>
                                            </Grid>
                                        </Border>
                                    </Border>
                                </Border>
                                <Border x:Name="SelectedBorder" BorderBrush="{ThemeResource PhoneAccentBrush}" BorderThickness="4" IsHitTestVisible="False" Opacity="0">
                                    <Grid x:Name="SelectedCheckMark" HorizontalAlignment="Right" Height="34" VerticalAlignment="Top" Width="34">
                                        <Path x:Name="SelectedEarmark" Data="M0,0 L40,0 L40,40 z" Fill="{ThemeResource PhoneAccentBrush}" Stretch="Fill"/>
                                        <Path x:Name="SelectedGlyph" Data="M0,123 L39,93 L124,164 L256,18 L295,49 L124,240 z" Fill="White" FlowDirection="LeftToRight" HorizontalAlignment="Right" Height="14.5" Margin="0,1,1,0" Stretch="Fill" VerticalAlignment="Top" Width="17"/>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--Tower of Hanoi Templates-->
        <ItemsPanelTemplate x:Key="TowerofHanoiGridViewItemsPanel">
            <VariableSizedWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="3"/>
        </ItemsPanelTemplate>
        <DataTemplate x:Key="Narrow150x250ItemTemplate">
            <Rectangle RadiusX="10" RadiusY="10" Height="34" Width="{Binding Width,Converter={StaticResource DiskWidthConverter},ConverterParameter=0, Mode=OneWay}" Fill="{Binding Brush}" AllowDrop="{Binding IsDraggable}" />
        </DataTemplate>

    </Page.Resources>

    <!--LayoutRoot is the root grid where all page content is placed-->
    <Grid x:Name="LayoutRoot" Margin="2">
        <Grid.ChildrenTransitions>
            <TransitionCollection>
                <ContentThemeTransition/>
            </TransitionCollection>
        </Grid.ChildrenTransitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <MediaElement x:Name="DiskDropSound" AutoPlay="False"
                      Source="ms-appx:///Assets/DiskDrop.wav"/>
        <MediaElement x:Name="LevelCompletedSound" AutoPlay="False"
                      Source="ms-appx:///Assets/LevelCompleted.wav"/>

        <Popup x:Name="MenuPopup" IsLightDismissEnabled="True" IsOpen="False" Closed="MenuPopupClosed">
            <Grid Background="White">
                <Grid.Transitions>
                    <TransitionCollection>
                        <EntranceThemeTransition FromHorizontalOffset="-10"/>
                    </TransitionCollection>
                </Grid.Transitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="5*"/>
                    <RowDefinition Height="5*"/>
                    <RowDefinition Height="5*"/>
                    <RowDefinition Height="5*"/>
                    <RowDefinition Height="5*"/>
                </Grid.RowDefinitions>

                <AppBarButton Grid.Row="0" Grid.Column="0"
                    Icon="Help"
                    Label="help">
                    <AppBarButton.Flyout>
                        <Flyout x:Name="HelpFlyout" Placement="Full">
                            <Flyout.FlyoutPresenterStyle>
                                <Style TargetType="FlyoutPresenter">
                                    <Setter Property="Background" Value="White"/>
                                </Style>
                            </Flyout.FlyoutPresenterStyle>
                            <Grid Margin="4">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <AppBarButton Tag="Help"
                                              Grid.Row="0" Grid.Column="0"
                                              Tapped="PopupBackButtonTapped"
                                              Icon="Back"/>
                                <TextBlock Margin="2,16,0,0" Grid.Column="1" Style="{ThemeResource FlyoutPickerTitleTextBlockStyle}" Text="INSTRUCTIONS"/>
                                <TextBlock Style="{StaticResource BodyTextBlockStyle}" Grid.Row="1" Grid.Column="1" LineHeight="30">
                            	    <Run Text="1. Only one disk should be moved at a time."/>
                            	    <LineBreak/>
                            	    <Run Text="2. Each move consists of taking the top disk from one of the poles and sliding it onto another pole."/>
                            	    <LineBreak/>
                            	    <Run Text="3. No disk can be placed on top of a smaller disk."/>
                            	    <LineBreak/>
                            	    <Run Text="4. End of game comes when you move all the disk from Pole A to Pole C."/>
                            	    <LineBreak/>
                                    <Run Text="5. Tap and hold on a disk to move disk from one pole to another."/>
                            	    <LineBreak/>
                                    <Run Text="6. Explore game settings and other options."/>
                            	    <LineBreak/>
                                </TextBlock>
                            </Grid>
                        </Flyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton Grid.Row="0" Grid.Column="1"
                              Icon="{Binding GameSettings.IsGameSoundEnabled, Converter={StaticResource IconConverter}, Mode=OneWay}"
                              Label="sound"
                              Command="{Binding GameSoundSettingsCommand}"/>
                <AppBarButton Grid.Row="1" Grid.Column="0"
                              Icon="Undo"
                              Label="undo"
                              Tapped="MenuPopupButtonTapped"
                              IsEnabled="{Binding CanUndoLastMove}"
                              Command="{Binding UndoLastMoveCommand}">
                </AppBarButton>
                <AppBarButton Grid.Row="1" Grid.Column="1"
                              Icon="Refresh"
                              Label="restart"
                              Tapped="MenuPopupButtonTapped"
                              Command="{Binding RestartLevelCommand}"/>
                <AppBarButton Grid.Row="2" Grid.Column="0"
                              ToolTipService.ToolTip="Go to Previous level" 
                              Icon="Back" 
                              Label="previous level"
                              Tapped="MenuPopupButtonTapped"
                              IsEnabled="{Binding CanGoToPreviousLevel}"
                              Command="{Binding GotoPreviousLevelCommand}"/>
                <AppBarButton Grid.Row="2" Grid.Column="1"
                              ToolTipService.ToolTip="Go to Next level" 
                              Icon="Forward" 
                              Label="next level"
                              Tapped="MenuPopupButtonTapped"
                              IsEnabled="{Binding CanGoToNextLevel}"
                              Command="{Binding GotoNextLevelCommand}"/>
                <AppBarButton Grid.Row="3" Grid.Column="0"
                          ToolTipService.ToolTip="Choose level" 
                          Icon="Go"
                          Label="choose level">
                    <AppBarButton.Flyout>
                        <Flyout x:Name="LevelChooser" Placement="Full" Opening="Level_Chooser_Flyout_Opened">
                            <Flyout.FlyoutPresenterStyle>
                                <Style TargetType="FlyoutPresenter">
                                    <Setter Property="Background" Value="White"/>
                                </Style>
                            </Flyout.FlyoutPresenterStyle>
                            <Grid Margin="4">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <AppBarButton Tag="Level"
                                              Grid.Row="0" Grid.Column="0"
                                              Tapped="PopupBackButtonTapped"
                                              Icon="Back"/>
                                <TextBlock Margin="2,16,0,0" Grid.Column="1" Style="{ThemeResource FlyoutPickerTitleTextBlockStyle}" Text="CHOOSE LEVEL"/>
                                <GridView x:Name="LevelChooserGrid"
                                          Grid.Row="1" Grid.Column="1"
                                          Margin="5"
                                          VerticalAlignment="Top"
                                          SelectionMode="Extended"
                                          IsItemClickEnabled="True"
                                          IsSwipeEnabled="True"
                                          IsRightTapEnabled="True"
                                          HorizontalAlignment="Center"
                                          ItemClick="LevelChooserGrid_ItemClick"
                                          ItemsPanel="{StaticResource TowerofHanoiGridViewItemsPanel}" 
                                          ItemContainerStyle="{StaticResource TowerofHanoiGridViewItemStyle}">
                                    <GridView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Height="60" Width="60">
                                                <TextBlock Style="{ThemeResource ListViewItemTextBlockStyle}" 
                                                           Foreground="{ThemeResource PhoneForegroundBrush}"
                                                           Text="{Binding}" TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Grid>
                                        </DataTemplate>
                                    </GridView.ItemTemplate>
                                </GridView>
                            </Grid>
                        </Flyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton Grid.Row="3" Grid.Column="1"
                          ToolTipService.ToolTip="Choose theme" 
                          Icon="BrowsePhotos"
                          Label="choose theme">
                    <AppBarButton.Flyout>
                        <Flyout x:Name="ThemeChooser" Placement="Full">
                            <Flyout.FlyoutPresenterStyle>
                                <Style TargetType="FlyoutPresenter">
                                    <Setter Property="Background" Value="White"/>
                                </Style>
                            </Flyout.FlyoutPresenterStyle>
                            <Grid Margin="4">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <AppBarButton Tag="Theme"
                                              Grid.Row="0" Grid.Column="0"
                                              Tapped="PopupBackButtonTapped"
                                              Icon="Back"/>
                                <TextBlock Margin="2,16,0,0" Grid.Row="0" Grid.Column="1" Style="{ThemeResource FlyoutPickerTitleTextBlockStyle}" Text="CHOOSE THEME"/>
                                <GridView x:Name="ThemeChooserGrid"
                                          Grid.Row="1" Grid.Column="1" 
                                          ItemClick="ThemeChooserGrid_ItemClick"
                                          SelectionMode="Single"
                                          IsSwipeEnabled="True"
                                          IsRightTapEnabled="True"
                                          IsItemClickEnabled="True"
                                          HorizontalAlignment="Center"
                                          ItemsPanel="{StaticResource TowerofHanoiGridViewItemsPanel}" 
                                          ItemContainerStyle="{StaticResource TowerofHanoiGridViewItemStyle}">
                                    <GridView.Items>
                                        <GridViewItem >
                                            <Image Tag="0" Height="140" Width="200" Source="ms-appx:///Assets/Day_Theme.png" Stretch="UniformToFill" />
                                        </GridViewItem>
                                        <GridViewItem>
                                            <Image Tag="1" Height="140" Width="200" Source="ms-appx:///Assets/Night_Theme.png" Stretch="UniformToFill" />
                                        </GridViewItem>
                                    </GridView.Items>
                                </GridView>
                            </Grid>
                        </Flyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton Grid.Row="4" Grid.Column="0"
                          ToolTipService.ToolTip="Leaderboards" 
                          Icon="Bullets"
                          Label="leaderboards">
                    <AppBarButton.Flyout>
                        <Flyout x:Name="LeaderBoards" Placement="Full" Opening="Leaderboard_Flyout_Opened">
                            <Flyout.FlyoutPresenterStyle>
                                <Style TargetType="FlyoutPresenter">
                                    <Setter Property="Background" Value="White"/>
                                </Style>
                            </Flyout.FlyoutPresenterStyle>
                            <Grid Margin="4">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="60"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <AppBarButton Tag="LeaderBoard"
                                              Grid.Row="0" Grid.Column="0"
                                              Tapped="PopupBackButtonTapped"
                                              Icon="Back"/>
                                <TextBlock Margin="2,16,0,0" Grid.Row="0" Grid.Column="1" Style="{ThemeResource FlyoutPickerTitleTextBlockStyle}" Text="LEADERBOARDS"/>
                                <GridView x:Name="LeaderboardGrid"
                                          IsHitTestVisible="False"
                                          Grid.Row="1" Grid.Column="1"
                                          HorizontalAlignment="Stretch"
                                          HorizontalContentAlignment="Stretch">
                                    <GridView.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Style="{ThemeResource TowerOfHanoiLeaderBoardHeaderStyle}" Text="LEVEL"/>
                                            <TextBlock Style="{ThemeResource TowerOfHanoiLeaderBoardHeaderStyle}" Text="BEST MOVES"/>
                                            <TextBlock Style="{ThemeResource TowerOfHanoiLeaderBoardHeaderStyle}" Width="150" Text="PLAYER MOVES"/>
                                            <TextBlock Style="{ThemeResource TowerOfHanoiLeaderBoardHeaderStyle}" Margin="-25 4" HorizontalAlignment="Center" Text="TIME"/>
                                        </StackPanel>
                                    </GridView.Header>
                                    <GridView.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <VariableSizedWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="1"/>
                                        </ItemsPanelTemplate>
                                    </GridView.ItemsPanel>
                                    <GridView.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel DataContext="{Binding}" Orientation="Horizontal">
                                                <TextBlock Style="{ThemeResource TowerOfHanoiLeaderBoardTextStyle}" Text="{Binding Level}"/>
                                                <TextBlock Style="{ThemeResource TowerOfHanoiLeaderBoardTextStyle}" Text="{Binding BestMoves}"/>
                                                <TextBlock Style="{ThemeResource TowerOfHanoiLeaderBoardTextStyle}" Text="{Binding PlayerMoves}"/>
                                                <TextBlock Style="{ThemeResource TowerOfHanoiLeaderBoardTextStyle}" Text="{Binding Time}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridView.ItemTemplate>
                                </GridView>
                            </Grid>
                        </Flyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton Grid.Row="4" Grid.Column="1"
                              ToolTipService.ToolTip="Rate and Review" 
                              Icon="LikeDislike"
                              Label="rate and review"
                              Tapped="RateAndReviewButtonTapped">
                </AppBarButton>
            </Grid>
        </Popup>

        <Grid x:Name="GameInfoGrid" Grid.Row="1" Grid.Column="1" Margin="4, 4"
              HorizontalAlignment="Stretch" VerticalAlignment="Top">

            <Grid.ChildrenTransitions>
                <TransitionCollection>
                    <EntranceThemeTransition/>
                </TransitionCollection>
            </Grid.ChildrenTransitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="75"/>
                <RowDefinition Height="40"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="32"/>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="50"/>
            </Grid.ColumnDefinitions>

            <Grid x:Name="MenuStackButton" IsHitTestVisible="True" Grid.Column="0" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Stretch" Background="Transparent" Tapped="MenuStackButton_Tapped" Canvas.ZIndex="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Line x:Name="Line1" Grid.Row="0" Style="{ThemeResource TowerOfHanoiMenuStyle}" Tapped="MenuStackButton_Tapped"/>
                <Line x:Name="Line2" Grid.Row="1" Style="{ThemeResource TowerOfHanoiMenuStyle}" Tapped="MenuStackButton_Tapped"/>
                <Line x:Name="Line3" Grid.Row="2" Style="{ThemeResource TowerOfHanoiMenuStyle}" Tapped="MenuStackButton_Tapped"/>
            </Grid>

            <Grid Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Image Source="ms-appx:///Assets/Cloud2.png" Stretch="Fill" />
                <TextBlock x:Name="TxtBestMoves"
                       Text="{Binding BestMoves, Converter={StaticResource GameValueConverter},ConverterParameter=1, Mode=OneWay}"
                       Style="{ThemeResource TowerOfHanoiPhoneInfoTextBlockStyle}"/>
            </Grid>
            <Grid Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Image Source="ms-appx:///Assets/Cloud2.png" Stretch="Fill" />
                <TextBlock x:Name="TxtCurrentLevel"
                       Text="{Binding CurrentLevel, Converter={StaticResource GameValueConverter},ConverterParameter=2, Mode=OneWay}"
                       Style="{ThemeResource TowerOfHanoiPhoneInfoTextBlockStyle}"/>
            </Grid>
            <Grid Grid.Column="3" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Image Source="ms-appx:///Assets/Cloud2.png" Stretch="Fill" />
                <TextBlock x:Name="TxtPlayerMoves"
                       Text="{Binding PlayerMoves, Converter={StaticResource GameValueConverter},ConverterParameter=3, Mode=OneWay}"
                       Style="{ThemeResource TowerOfHanoiPhoneInfoTextBlockStyle}"/>
            </Grid>

            <StackPanel Grid.Column="4" Background="Transparent" VerticalAlignment="Center" HorizontalAlignment="Stretch">
                <AppBarButton
                    x:Name="UndoMove"
                    IsCompact="True"
                    Icon="Undo"
                    Label="undo"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Stretch"
                    IsEnabled="{Binding CanUndoLastMove}"
                    Command="{Binding UndoLastMoveCommand}">
                </AppBarButton>
            </StackPanel>
            <TextBlock x:Name="TxtTimer" Grid.Row="2" Grid.Column="2" 
                       HorizontalAlignment="Center" VerticalAlignment="Top" 
                       Style="{ThemeResource SubheaderTextBlockStyle}" Text=""/>
        </Grid>

        <Grid x:Name="GameGrid" Grid.Row="2" Grid.Column="0"
              HorizontalAlignment="Center" VerticalAlignment="Bottom">

            <Grid.ChildrenTransitions>
                <TransitionCollection>
                    <EntranceThemeTransition/>
                </TransitionCollection>
            </Grid.ChildrenTransitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="40"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="Pole A" Grid.Row="1" Grid.Column="0"
                       Style="{ThemeResource  TowerOfHanoiPhoneTitleTextBlockStyle}"/>
            <TextBlock Text="Pole B" Grid.Row="1" Grid.Column="1"
                       Style="{ThemeResource TowerOfHanoiPhoneTitleTextBlockStyle}"/>
            <TextBlock Text="Pole C" Grid.Row="1" Grid.Column="2"
                       Style="{ThemeResource TowerOfHanoiPhoneTitleTextBlockStyle}"/>

            <ListView x:Name="PoleA"
                      Tag="A" Grid.Row="0" Grid.Column="0"
                      ItemsSource="{Binding PoleADisks}"
                      PointerEntered="Pole_PointerEntered"
                      DragItemsStarting="ListViewBase_OnDragItemsStarting"
                      Drop="UIElement_OnDrop"
                      Style="{StaticResource TowerOfHanoiListViewStyle}"
                      ItemTemplate="{Binding Source={StaticResource Narrow150x250ItemTemplate}}" />
            <ListView x:Name="PoleB"
                      Tag="B" Grid.Row="0" Grid.Column="1"
                      ItemsSource="{Binding PoleBDisks}"
                      PointerEntered="Pole_PointerEntered"
                      DragItemsStarting="ListViewBase_OnDragItemsStarting"
                      Drop="UIElement_OnDrop"
                      Style="{StaticResource TowerOfHanoiListViewStyle}"
                      ItemTemplate="{Binding Source={StaticResource Narrow150x250ItemTemplate}}" />
            <ListView x:Name="PoleC"
                      Tag="C" Grid.Row="0" Grid.Column="2"
                      ItemsSource="{Binding PoleCDisks}"
                      PointerEntered="Pole_PointerEntered"
                      DragItemsStarting="ListViewBase_OnDragItemsStarting"
                      Drop="UIElement_OnDrop"
                      Style="{StaticResource TowerOfHanoiListViewStyle}"
                      ItemTemplate="{Binding Source={StaticResource Narrow150x250ItemTemplate}}" />
        </Grid>
    </Grid>

    <FlyoutBase.AttachedFlyout>
        <Flyout x:Name="GameMessagePopup" Placement="Full" Closed="GameMessagePopup_Closed">
            <Flyout.FlyoutPresenterStyle>
                <Style TargetType="FlyoutPresenter">
                    <Setter Property="ScrollViewer.ZoomMode" Value="Disabled"/>
                    <Setter Property="Background" Value="{ThemeResource AppBarItemDisabledForegroundThemeBrush}"/>
                    <Setter Property="ContentTransitions">
                        <Setter.Value>
                            <TransitionCollection>
                                <PopupThemeTransition/>
                            </TransitionCollection>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Flyout.FlyoutPresenterStyle>
            <Grid x:Name="PopupGrid" HorizontalAlignment="Stretch" VerticalAlignment="Center" Background="White">
                <Grid.ChildrenTransitions>
                    <TransitionCollection>
                        <PopupThemeTransition/>
                    </TransitionCollection>
                </Grid.ChildrenTransitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock x:Name="TxtMessage" Grid.Row="0"
                           TextWrapping="WrapWholeWords"
                           FontSize="32"
                           FontFamily="{ThemeResource PhoneFontFamilySemiLight}"
                           TextAlignment="Center"
                           Text="Congrats! You have completed the Game. Thanks for playing, Please share your reviews."/>
                <StackPanel x:Name="BtnStackWarning" Grid.Row="1" Margin="5" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Button Tag="0" Tapped="GameMessagePopup_Tapped">
                        ok
                    </Button>
                </StackPanel>
                <StackPanel x:Name="BtnStackConfirmation" Grid.Row="1" Margin="5" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Button Tag="1" Tapped="GameMessagePopup_Tapped" Margin="5">
                        restart level
                    </Button>
                    <Button Tag="2" Tapped="GameMessagePopup_Tapped" Margin="5">
                        next level
                    </Button>
                </StackPanel>
                <StackPanel x:Name="BtnRateAndReview" Grid.Row="1" Margin="5" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Button Tapped="RateAndReviewButtonTapped">
                        rate and review
                    </Button>
                </StackPanel>
            </Grid>
        </Flyout>
    </FlyoutBase.AttachedFlyout>
</Page>

    